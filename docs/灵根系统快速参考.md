# 灵根系统快速参考

## 🎯 核心概念

灵根决定角色的修炼天赋，影响修炼速度和突破成功率。用户注册时自动随机分配。

## 📊 灵根类型一览

| 灵根 | 修炼效率 | 突破加成 | 获得概率 | 稀有度 |
|------|----------|----------|----------|--------|
| 天灵根 | **2.0倍** | **+15%** | 0.45% | 传说 ⭐⭐⭐⭐⭐ |
| 变异灵根 | **1.5倍** | **+10%** | 1.34% | 史诗 ⭐⭐⭐⭐ |
| 单灵根 | **1.2倍** | **+5%** | 8.93% | 优秀 ⭐⭐⭐ |
| 双灵根 | 1.1倍 | - | 17.86% | 普通 ⭐⭐ |
| 三灵根 | 1.0倍 | - | 17.86% | 普通 ⭐⭐ |
| 四灵根 | 0.9倍 | - | 17.86% | 普通 ⭐ |
| 五灵根 | 0.8倍 | - | 17.86% | 普通 ⭐ |
| 废灵根 | 0.7倍 | - | 17.86% | 普通 ⭐ |

## ⚡ 效果对比

### 修炼效率（30天对比）
- **天灵根**：相当于普通灵根 **64天** 修炼效果
- **变异灵根**：相当于普通灵根 **45天** 修炼效果  
- **单灵根**：相当于普通灵根 **38天** 修炼效果
- **三灵根**：30天（基准）
- **废灵根**：相当于普通灵根 **20天** 修炼效果

### 突破成功率（示例：境界5→6）
- **天灵根**：59% 成功率
- **变异灵根**：54% 成功率
- **单灵根**：49% 成功率
- **其他灵根**：44% 成功率

## 🎲 获得概率

```
稀有灵根总概率：10.72%
├─ 天灵根：0.45% (约222人中1人)
├─ 变异灵根：1.34% (约75人中1人)  
└─ 单灵根：8.93% (约11人中1人)

普通灵根总概率：89.28%
```

## 🔧 技术要点

### 权重系统
```python
权重分配：
天灵根: 1    (传说级)
变异灵根: 3   (史诗级)  
单灵根: 20   (优秀级)
其他: 40×5   (普通级)
总权重: 224
```

### 核心文件
- `shared/constants.py` - 灵根配置
- `server/database/crud.py` - 注册分配逻辑
- `server/core/character_service.py` - 突破计算
- `server/core/systems/cultivation_system.py` - 修炼计算

### 关键函数
```python
# 随机分配灵根
CharacterCRUD._get_random_spiritual_root()

# 修炼速度应用
spiritual_root_bonus = SPIRITUAL_ROOTS[character.spiritual_root]["multiplier"]

# 突破加成应用  
breakthrough_bonus = root_info.get("breakthrough_bonus", 0.0)
```

## 🧪 测试验证

### 运行测试
```bash
# 基础系统测试
python tests/test_spiritual_root_system.py

# 注册分配测试
python tests/test_user_registration_spiritual_root.py

# 游戏效果测试
python tests/test_spiritual_root_game_effects.py
```

### 测试结果
✅ 权重系统正确  
✅ 概率分布准确  
✅ 修炼速度影响生效  
✅ 突破加成正确计算  
✅ 自动分配功能正常  

## 🎮 游戏影响

### 对新手玩家
- 89%概率获得普通灵根
- 11%概率获得稀有灵根（惊喜）
- 所有灵根都可正常游戏

### 对稀有灵根玩家
- 修炼效率显著提升
- 突破更容易成功
- 长期发展优势明显

### 游戏平衡
- 稀有灵根概率低，不影响整体平衡
- 普通灵根玩家仍有完整游戏体验
- 其他系统（气运、装备等）同样重要

## 📝 快速配置

### 调整概率
修改 `shared/constants.py` 中的 `weight` 值：
```python
"天灵根": {"weight": 1},    # 调整为2可翻倍概率
"变异灵根": {"weight": 3},   # 调整为6可翻倍概率
```

### 调整效果
修改 `multiplier` 和 `breakthrough_bonus`：
```python
"天灵根": {
    "multiplier": 2.0,        # 修炼效率倍率
    "breakthrough_bonus": 0.15 # 突破成功率加成
}
```

## ⚠️ 注意事项

1. **不要随意修改权重**：会影响游戏平衡
2. **测试后再上线**：任何修改都要先测试
3. **监控数据**：关注实际分配比例和游戏表现
4. **保持文档更新**：修改后及时更新文档

## 🔗 相关文档

- [灵根系统总结文档.md](./灵根系统总结文档.md) - 完整技术文档
- [洞府系统功能说明.md](./洞府系统功能说明.md) - 洞府系统文档
- [游戏系统设计文档.md](./游戏系统设计文档.md) - 整体设计文档

---

**快速参考版本**：v1.0  
**对应系统版本**：灵根系统 v1.0  
**最后更新**：2025-07-17
