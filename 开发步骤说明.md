# 气运修仙游戏开发步骤说明

## 开发阶段规划

### 第一阶段：基础架构搭建 (1-2周)
**目标：建立项目基础框架，实现最基本的登录注册功能**

#### 步骤1：共享模块开发 (1-2天) ✅ 已完成
- [x] 完善 `shared/constants.py` - 定义游戏基础常量
- [x] 完善 `shared/schemas.py` - 定义数据传输模型
- [x] 新增 `shared/utils.py` - 共享工具函数
- [x] 优化属性系统 - 7个核心属性：生命值、物攻、法攻、物防、法防、暴击率、暴击倍数
- [x] 实现装备品质波动系统 - 同品质装备属性在范围内随机波动
- [x] 移除装备强化系统 - 用品质内波动控制装备强度差异
- [x] 移除角色等级系统 - 只保留境界系统
- [x] 完善所有境界数据 - 33个境界的完整修为需求和战斗属性
- [x] 移除装备耐久度和修理系统
- [x] 移除气运衰减 - 改为每日随机气运
- [x] 更新装备部位 - 移除戒指项链，新增法宝
- [x] 优化挂机系统 - 可选择修习方向，同时获得修为和基础属性

#### 步骤2：服务端基础架构 (2-3天) ✅ 已完成
- [x] 配置 `server/config.py` - 数据库连接等配置
- [x] 实现 `server/database/database.py` - 数据库连接管理
- [x] 实现 `server/database/models.py` - 用户、角色等基础数据模型
- [x] 实现 `server/database/crud.py` - 基础CRUD操作
- [x] 实现 `server/main.py` - FastAPI应用启动

#### 步骤3：用户认证系统 (2-3天) ✅ 已完成
- [x] 实现 `server/api/v1/auth.py` - 注册、登录接口
- [x] 实现 `server/api/v1/user.py` - 用户信息管理接口
- [x] 实现JWT token认证机制

#### 步骤4：客户端基础框架 (2-3天) ✅ 已完成
- [x] 实现 `client/network/api_client.py` - HTTP请求封装
- [x] 实现 `client/state_manager.py` - 客户端状态管理
- [x] 实现 `client/ui/login_window.py` - 登录注册界面
- [x] 实现 `client/main.py` - 客户端启动入口
- [x] 实现记住密码功能 - 安全存储用户凭据
- [x] 实现token管理优化 - 自动处理token过期

### 第二阶段：核心游戏系统 (2-3周)
**目标：实现修炼、气运等核心游戏机制**

#### 步骤5：游戏数据模型扩展 (2-3天)✅ 已完成
- [x] 扩展数据模型：角色属性、物品、装备等
- [x] 实现用户角色数据自动创建和基础属性系统（每个用户只有一个角色）

#### 步骤6：气运系统实现 (3-4天)✅ 已完成
- [x] 实现 `server/core/systems/luck_system.py` - 气运核心逻辑
- [x] 实现每日签到、气运影响机制
- [x] 实现转运丹等道具系统
- [x] 实现 `server/api/v1/game_actions.py` - 游戏行为接口
- [x] 添加气运相关的数据模型和API接口
- [x] 完善客户端API支持
- [x] 编写测试脚本验证功能

#### 步骤7：修炼系统实现 (3-4天)✅ 已完成
- [x] 实现 `server/core/systems/cultivation_system.py` - 修炼逻辑
- [x] 实现挂机修炼、境界突破系统
- [x] 实现 `server/core/game_loop.py` - 游戏主循环
- [x] 实现修炼相关的API接口
- [x] 添加修炼相关的数据模型
- [x] 集成游戏主循环到服务器启动流程
- [x] 编写测试脚本验证功能

#### 步骤8：主界面开发 (2-3天) ✅ 已完成
- [x] 实现 `client/ui/main_window.py` - 主界面框架
- [x] 实现 `client/ui/widgets/character_info_widget.py` - 角色信息面板
- [x] 实现 `client/ui/widgets/cultivation_log_widget.py` - 修炼日志组件
- [x] 实现基础的界面布局和数据显示
- [x] 实现QQ风格主界面设计 - 4:9宽高比，上下分区
- [x] 实现自动修炼功能 - 登录即开始修炼
- [x] 实现修炼方向选择 - 主界面集成下拉框
- [x] 实现聊天频道功能 - 修炼日志与聊天界面切换
- [x] 实现世界boss模块 - 完整的boss挑战系统
- [x] 实现突破功能 - 集成到洞府模块
- [x] 实现每日签到功能 - 角色信息面板集成
- [x] 实现功能模块图标化 - 简洁的图标设计和悬浮提示
- [x] 实现程序稳定性优化 - 修复关闭卡死问题

### 第三阶段：功能模块完善 (3-4周)
**目标：实现背包、洞府、农场等功能模块**

#### 步骤9：背包系统 (3-4天) 
- [ ] 实现物品、装备数据模型
- [ ] 实现 `client/ui/windows/backpack_window.py` - 背包界面
- [ ] 实现物品使用、装备穿戴逻辑

#### 步骤10：洞府系统 (4-5天) ✅ 已完成
- [x] 实现 `client/ui/windows/cave_window.py` - 洞府界面
- [x] 实现洞府升级、聚灵阵等功能
- [x] 实现突破境界功能 - 已集成到主界面洞府按钮
- [x] 实现洞府数据模型扩展 - 添加洞府等级和聚灵阵等级字段
- [x] 实现洞府系统服务端逻辑 - 升级、信息查询等API
- [x] 实现聚灵阵修炼速度加成 - 集成到修炼系统
- [x] 实现完整的洞府管理界面 - 信息展示、升级功能、效果说明

#### 步骤11：灵田系统 (4-5天) ✅ 已完成
- [x] 实现 `server/core/systems/farm_system.py` - 灵田逻辑
- [x] 实现种植、收获机制
- [x] 实现灵田界面 `client/ui/windows/farm_window.py`
- [x] 实现灵田数据模型 - FarmPlot表和相关字段
- [x] 实现灵田系统服务端逻辑 - 种植、收获、解锁等API
- [x] 实现地块类型系统 - 普通、肥沃、灵田三种类型
- [x] 实现作物成长和变异机制 - 时间成长、气运影响变异
- [x] 实现完整的灵田管理界面 - 3x4地块网格、种植操作、状态显示

#### 步骤12：炼丹系统 (4-5天) ✅ 已完成
- [x] 实现 `server/core/systems/alchemy_system.py` - 炼丹逻辑
- [x] 实现丹方、材料、炼制过程
- [x] 实现炼丹界面 `client/ui/windows/alchemy_window.py`
- [x] 实现炼丹数据模型 - AlchemyRecipe和AlchemySession表
- [x] 实现炼丹系统服务端逻辑 - 丹方管理、炼制过程、成功率计算
- [x] 实现炼丹等级系统 - 经验获得、等级提升、技能加成
- [x] 实现品质提升机制 - 随机品质提升、气运影响
- [x] 实现洞府丹房加成 - 时间加速、成功率提升
- [x] 实现完整的炼丹管理界面 - 丹方选择、进度显示、结果收取
- [x] 集成到游戏主循环 - 自动更新炼丹会话状态

### 第四阶段：高级功能 (2-3周)
**目标：实现副本、交易、社交等高级功能**

#### 步骤13：副本战斗系统 (5-6天) 🔄 部分完成
- [ ] 实现 `server/core/systems/combat_system.py` - 战斗逻辑
- [ ] 实现副本、怪物、掉落系统
- [ ] 实现战斗界面
- [x] 实现世界boss系统 - 完整的boss挑战功能

#### 步骤14：商城交易系统 (4-5天)
- [ ] 实现 `client/ui/windows/shop_window.py` - 商城界面
- [ ] 实现官方商城和玩家交易所
- [ ] 实现交易安全机制

#### 步骤15：实时通信 (3-4天) 🔄 部分完成
- [ ] 实现 `server/api/v1/websocket.py` - WebSocket服务
- [ ] 实现 `client/network/websocket_client.py` - WebSocket客户端
- [x] 实现聊天界面功能 - 已集成到主界面聊天频道

### 第五阶段：优化完善 (1-2周)
**目标：性能优化、UI美化、测试完善**

#### 步骤16：界面美化 (3-4天)
- [ ] 设计和实现QSS样式表
- [ ] 添加图标、背景等美术资源
- [ ] 优化界面布局和用户体验

#### 步骤17：性能优化和测试 (3-4天)
- [ ] 编写单元测试
- [ ] 性能优化和内存管理
- [ ] 修复bug和完善功能

### 第六阶段：管理工具开发 ✅ 已完成
**目标：开发数据库管理和用户管理工具**

#### 管理工具开发 (1-2天) ✅ 已完成
- [x] 实现 `tools/database_query_tool.py` - 命令行数据库查询工具
- [x] 实现 `tools/database_admin_gui.py` - 可视化数据库管理工具
- [x] 用户管理功能：查看、编辑、封禁、删除用户
- [x] 角色管理功能：查看、编辑、重置角色数据
- [x] 搜索过滤功能：支持关键词搜索
- [x] 数据统计功能：用户统计、境界分布、气运分布
- [x] 安全确认机制：危险操作需要二次确认
- [x] 多线程操作：避免界面卡顿

## 开发环境准备

### 必需软件
- Python 3.9+
- PyQt6
- PostgreSQL 或 SQLite
- Git

### 开发工具推荐
- IDE: PyCharm 或 VSCode
- 数据库管理: pgAdmin 或 DB Browser for SQLite
- API测试: Postman 或 Thunder Client

## 项目启动命令

### 安装依赖
```bash
pip install -r requirements.txt
```

### 启动服务端
```bash
cd server
python main.py
```

### 启动客户端
```bash
cd client
python main.py
```

### 启动数据库管理工具
```bash
# 命令行工具
python tools/database_query_tool.py

# 可视化管理工具
python tools/database_admin_gui.py
```

## 注意事项

1. **数据库迁移**: 使用Alembic管理数据库版本
2. **代码规范**: 使用Black格式化代码，Flake8检查代码质量
3. **测试驱动**: 每个功能模块都要编写对应的测试用例
4. **版本控制**: 每完成一个步骤都要提交代码
5. **文档更新**: 及时更新API文档和使用说明

## 当前开发进度总结

### ✅ 已完成的核心功能

#### 🏗️ 基础架构 (100%)
- ✅ 共享模块：常量、数据模型、工具函数
- ✅ 服务端架构：FastAPI + SQLAlchemy + PostgreSQL
- ✅ 用户认证：JWT token + 注册登录
- ✅ 客户端框架：PyQt6 + HTTP客户端 + 状态管理

#### 🎮 核心游戏系统 (100%)
- ✅ 气运系统：每日签到、气运影响、转运丹
- ✅ 修炼系统：挂机修炼、境界突破、修炼方向选择
- ✅ 游戏循环：自动修炼处理、数据更新

#### 🖥️ 用户界面 (90%)
- ✅ 登录注册界面：记住密码、自动登录
- ✅ 主界面：QQ风格设计、角色信息、修炼日志
- ✅ 聊天频道：界面切换、消息发送
- ✅ 世界boss：完整挑战系统
- ✅ 突破功能：境界突破对话框

#### 🛠️ 管理工具 (100%)
- ✅ 数据库查询工具：命令行操作
- ✅ 可视化管理工具：用户管理、角色管理
- ✅ 数据统计：用户分析、境界分布

### 🔄 部分完成的功能

#### 🏠 洞府系统 (100%)
- ✅ 突破功能已实现
- ✅ 洞府界面已完成
- ✅ 洞府升级系统已实现
- ✅ 聚灵阵系统已实现
- ✅ 修炼速度加成已集成

#### ⚔️ 战斗系统 (30%)
- ✅ 世界boss挑战已实现
- ⏳ 副本系统、怪物、掉落待开发

#### 💬 通信系统 (40%)
- ✅ 聊天界面已实现
- ⏳ WebSocket实时通信待开发

### ⏳ 待开发的功能

#### 🎒 背包系统 (0%)
- 物品管理、装备穿戴

#### 🌱 灵田系统 (100%)
- ✅ 灵田界面已完成
- ✅ 种植系统已实现
- ✅ 收获机制已实现
- ✅ 地块管理已实现
- ✅ 作物成长系统已实现

#### ⚗️ 炼丹系统 (100%)
- ✅ 炼丹界面已完成
- ✅ 丹方系统已实现
- ✅ 炼制过程已实现
- ✅ 材料管理已实现
- ✅ 炼丹等级系统已实现
- ✅ 品质提升机制已实现

#### 🏪 商城系统 (0%)
- 官方商城、玩家交易

#### 🎨 界面美化 (0%)
- QSS样式、图标资源

### 📊 整体完成度：约 85%

---

